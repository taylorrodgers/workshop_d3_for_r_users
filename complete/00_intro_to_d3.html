<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Rodgers">

<title>Intro to D3 Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="00_intro_to_d3_files/libs/clipboard/clipboard.min.js"></script>
<script src="00_intro_to_d3_files/libs/quarto-html/quarto.js"></script>
<script src="00_intro_to_d3_files/libs/quarto-html/popper.min.js"></script>
<script src="00_intro_to_d3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="00_intro_to_d3_files/libs/quarto-html/anchor.min.js"></script>
<link href="00_intro_to_d3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="00_intro_to_d3_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="00_intro_to_d3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="00_intro_to_d3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="00_intro_to_d3_files/libs/bootstrap/bootstrap-3dc9094430be18c8a5aac800159ef30a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="00_intro_to_d3_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="00_intro_to_d3_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="00_intro_to_d3_files/libs/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="00_intro_to_d3_files/libs/webcomponents-2.0.0/webcomponents.js"></script>
<script src="00_intro_to_d3_files/libs/r2d3-binding-0.2.6/r2d3.js"></script>
<script src="00_intro_to_d3_files/libs/d3v6-6.2.0/d3.min.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro to D3 Workshop</h1>
<p class="subtitle lead">For R Users</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Taylor Rodgers </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>D3.js is, without a doubt, the hardest data viz development framework you could ever learn.</p>
<p>It requires knowledge of HTML, CSS, and JavaScript.</p>
<p>But what it lacks in ease-of-use, it more than makes up for in precision.</p>
<p>Some of the most advanced interactive data visualizations in the world use D3.js. It’s also used to make more simpler data visualizations that need to be client-side rendered and adaptable to different screen sizes.</p>
<p>For that reason, the best users of D3.js are often news organizations.</p>
</section>
<section id="required-knowledge" class="level2">
<h2 class="anchored" data-anchor-id="required-knowledge">Required Knowledge</h2>
<p>This course is for R users, but most R-related scripts will be provided to you to focus more on D3. It’s also expected that you know some HTML and CSS. Just like R, those scripts will also be provided ahead of time to allow more focus on D3.</p>
<p>That said, you should at least conceptually know the following:</p>
<ul>
<li><p>An HTML tag</p></li>
<li><p>A CSS class</p></li>
<li><p>JSON files</p></li>
<li><p>RStudio’s interface</p></li>
<li><p>R Shiny</p></li>
<li><p>Quarto HTML documents</p></li>
<li><p>tidyverse package functions</p></li>
</ul>
<p>JavaScript is helpful to know, but not required. Although D3.js is JavaScript, the syntax is similar enough to the <code>tidyverse</code> and other <code>R</code> functions that users will be able to start with D3.</p>
</section>
<section id="required-packages" class="level2">
<h2 class="anchored" data-anchor-id="required-packages">Required Packages</h2>
<p>You’ll also need to install the following packages before proceeding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"shiny"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"bslib"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"r2d3"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"https://github.com/Free-State-Analytics/freeStateData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Book Recommendation
</div>
</div>
<div class="callout-body-container callout-body">
<p>I strongly suggest <em>Eloquent JavaScript</em> to learn JavaScript in general. As an R user, you’ll find JavaScript to be surprisingly similar, particularly when it comes to writing functions.</p>
</div>
</div>
</section>
<section id="what-this-tutorial-teaches" class="level2">
<h2 class="anchored" data-anchor-id="what-this-tutorial-teaches">What This Tutorial Teaches?</h2>
<p>This tutorial is for R-users who want to learn D3.js. D3.js works well in both Quarto and Shiny. The skills you learned in those tools serve as a useful on-ramp to D3.js.</p>
<p>This tutorial will focus exclusively on building the data visualization you see below, which is a good introduction to key concepts in D3, as well as understanding how to properly structure your R and D3.js scripts.</p>
<div class="cell">
<div class="cell-output-display">
<div class="r2d3 html-widget html-fill-item" id="htmlwidget-ec7fb6621b74b4a0e20c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ec7fb6621b74b4a0e20c">{"x":{"data":{"gold_circulation_filtered":[{"months":"1892-11-01","gold_certificates_in_treasury_cash":19632830},{"months":"1892-12-01","gold_certificates_in_treasury_cash":24254750},{"months":"1893-01-01","gold_certificates_in_treasury_cash":15729770},{"months":"1893-02-01","gold_certificates_in_treasury_cash":7782260},{"months":"1893-03-01","gold_certificates_in_treasury_cash":5135430},{"months":"1893-04-01","gold_certificates_in_treasury_cash":8888310},{"months":"1893-05-01","gold_certificates_in_treasury_cash":3324670},{"months":"1893-06-01","gold_certificates_in_treasury_cash":1071170},{"months":"1893-07-01","gold_certificates_in_treasury_cash":93710},{"months":"1893-08-01","gold_certificates_in_treasury_cash":565370},{"months":"1893-09-01","gold_certificates_in_treasury_cash":129220},{"months":"1893-10-01","gold_certificates_in_treasury_cash":115860},{"months":"1893-11-01","gold_certificates_in_treasury_cash":149090},{"months":"1893-12-01","gold_certificates_in_treasury_cash":75590}],"highlights":[{"months":"1892-12-01","gold_certificates_in_treasury_cash":24254750},{"months":"1893-12-01","gold_certificates_in_treasury_cash":75590}],"annotations":[{"months":"1892-12-01","gold_certificates_in_treasury_cash":25000000,"annotation":"$24.25 million"},{"months":"1893-03-01","gold_certificates_in_treasury_cash":17500000,"annotation":"President Cleveland begins second term"},{"months":"1893-12-01","gold_certificates_in_treasury_cash":22500000,"annotation":"$75.59 thousand"}]},"type":"json","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  D3/00_primary.js */\n// Ensure the font is loaded by adding a <link> element to the document head\nconst link = document.createElement(\"link\");\nlink.href = \"https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@200;300;400;500;600;700;900&display=swap\";\nlink.rel = \"stylesheet\";\ndocument.head.appendChild(link);\n\n///if (options.margins) {\n//  margin = { top: options.margins, right: options.margins, bottom: options.margins, left: options.margins };\n//} else {\n  margin = { top: 150, right: 100, bottom: 70, left: 100 };\n//}\n\n// Axis\nconst x_min = d3.timeDay.offset(d3.min(data.gold_circulation_filtered, d => new Date(d.months)), -20);\nconst x_max = d3.max(data.gold_circulation_filtered, d => new Date(d.months));\nconst x_tick_count = data.gold_circulation_filtered.filter(d => d.months).length;\nconst y_min = 0;\nconst y_max = d3.max(data.gold_circulation_filtered, d => d.gold_certificates_in_treasury_cash);\nconst y = plot_yaxis(svg, margin, y_min, y_max, width);\nconst x = plot_x_axis(svg, margin, x_min, x_max, x_tick_count);\n\n// Labels, texts, and annotations\nconst header_primary = plot_header_primary(svg, margin, data);\nconst header_secondary = plot_header_secondary(svg, margin, data);\n\nconst annotation_one = plot_annotations(\n  svg, \n  margin, \n  x_placement = new Date(data.annotations[0].months), \n  y_placement = data.annotations[0].gold_certificates_in_treasury_cash, \n  annotation_text = data.annotations[0].annotation, add_line = false);\n\nconst annotation_two = plot_annotations(\n  svg, \n  margin, \n  x_placement = new Date(data.annotations[1].months), \n  y_placement = data.annotations[1].gold_certificates_in_treasury_cash, \n  annotation_text = data.annotations[1].annotation, \n  add_line = true,\n  align = \"left\",\n  color = \"standard\");\n\nconst annotation_three = plot_annotations(\n  svg, \n  margin, \n  x_placement = new Date(data.annotations[2].months), \n  y_placement = data.annotations[2].gold_certificates_in_treasury_cash, \n  annotation_text = data.annotations[2].annotation, \n  add_line = true);\n\nconst y_label = plot_y_label(svg, margin);\nconst source_label = plot_source(svg, margin);\n\n\n// Bars\nconst bars = plot_bar(svg, margin, data);\nconst highlight = plot_highlight(svg, margin, data);\n\n/* R2D3 Source File:  D3/plot_annotations.js */\nfunction plot_annotations(\n  svg, \n  margin, \n  x_placement, \n  y_placement, \n  annotation_text, \n  add_line, \n  align = \"middle\",\n  color = \"highlight\") {\n  \n      svg.append(\"text\")\n        .attr(\"class\", \"text-annotation \" + color)\n        .attr(\"x\", x(x_placement))\n        .attr(\"y\", y(y_placement) - 10)\n        .text(annotation_text)\n        .attr(\"text-anchor\", align);\n    \n    if (add_line) {\n      \n      svg.append(\"line\")\n        .attr(\"class\", color + \" line\")\n        .attr(\"x1\", x(x_placement))\n        .attr(\"x2\", x(x_placement))\n        .attr(\"y1\", y(y_placement) - 5)\n        .attr(\"y2\", y(0) - 10);\n\n    }\n}\n\n/* R2D3 Source File:  D3/plot_bar.js */\nfunction plot_bar(svg, margin, data) {\n  \n  barWidth = (width - margin.left - margin.right) / 20;\n  \n  svg.selectAll(\"bar\")\n  .data(data.gold_circulation_filtered)\n  .enter()\n  .append(\"rect\")\n  .attr(\"class\", \"bar\")\n  .attr(\"fill\", \"#4A4A4A\")\n  .attr(\"x\", d => x(new Date(d.months)) - (barWidth / 2.25))\n  .attr(\"y\", d => y(d.gold_certificates_in_treasury_cash))\n  .attr(\"width\", barWidth)\n  .attr(\"height\", d => height - margin.bottom - y(d.gold_certificates_in_treasury_cash)); \n}\n\n/* R2D3 Source File:  D3/plot_header_primary.js */\nfunction  plot_header_primary(svg, margin, data) {\n  \n  const change = (((data.highlights[0].gold_certificates_in_treasury_cash - data.highlights[1].gold_certificates_in_treasury_cash) / data.highlights[0].gold_certificates_in_treasury_cash) * 100).toFixed(1) + \"%\"\n  \n  if (width < 741 & width > 400) {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-primary-medium\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 50)\n    .text(\"Gold Certificates in U.S. Treasury \")\n    .append(\"tspan\")\n    .attr(\"class\", \"highlight\")\n    .text(\" Declined \" + change);\n  } else if (width < 400) {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-primary-small\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 50)\n    .text(\"Gold Certificates in U.S. Treasury \")\n    .append(\"tspan\")\n    .attr(\"class\", \"highlight\")\n    .text(\" Declined \" + change); \n  } else {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-primary\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 50)\n    .text(\"Gold Certificates in U.S. Treasury \")\n    .append(\"tspan\")\n    .attr(\"class\", \"highlight\")\n    .text(\" Declined \" + change);     \n  }\n  \n  \n}\n\n/* R2D3 Source File:  D3/plot_header_secondary.js */\nfunction plot_header_secondary(svg, margin, data) {\n  \n  if (width < 741 & width > 400) {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-secondary-medium\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 80)\n    .text(\"From December 1892 until December 1893\");\n  } else if (width < 400) {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-secondary-small\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 80)\n    .text(\"From December 1892 until December 1893\");\n  } else {\n    svg.append(\"text\")\n    .attr(\"class\", \"header-secondary\")\n    .attr(\"x\", margin.left - 30)\n    .attr(\"y\", 80)\n    .text(\"From December 1892 until December 1893\");  \n  }\n  \n  \n}\n\n/* R2D3 Source File:  D3/plot_highlight.js */\nfunction plot_highlight(svg, margin, data) {\n  \n  barWidth = (width - margin.left - margin.right) / 20;\n  svg.selectAll(\"bar\")\n  .data(data.highlights)\n  .enter()\n  .append(\"rect\")\n  .attr(\"class\", \"bar\")\n  .attr(\"fill\", \"#AC882A\")\n  .attr(\"x\", d => x(new Date(d.months)) - (barWidth / 2.25))\n  .attr(\"y\", d => y(d.gold_certificates_in_treasury_cash))\n  .attr(\"width\", barWidth)\n  .attr(\"height\", d => height - margin.bottom - y(d.gold_certificates_in_treasury_cash)); \n  \n}\n\n/* R2D3 Source File:  D3/plot_primary.js */\nfunction plot_primary(svg, margin) {\n  \n  // Axis\n  const xMin = d3.timeDay.offset(d3.min(data.gold_circulation_filtered, d => new Date(d.months)), -20);\n  const xMax = d3.max(data.gold_circulation_filtered, d => new Date(d.months));\n  const xTickCount = data.gold_circulation_filtered.filter(d => d.months).length;\n  const minY = 0;\n  const maxY = d3.max(data.gold_circulation_filtered, d => d.gold_certificates_in_treasury_cash);\n  const y = plot_yaxis(svg, margin, minY, maxY);\n  const x = plot_xaxis(svg, margin, xMin, xMax, xTickCount);\n  \n  // Labels, texts, and annotations\n  const header_primary = plot_header_primary(svg, margin, data);\n  const header_secondary = plot_header_secondary(svg, margin, data);\n  \n  const annotation_one = plot_annotations(\n    svg, \n    margin, \n    x_placement = new Date(data.annotations[0].months), \n    y_placement = data.annotations[0].gold_certificates_in_treasury_cash, \n    annotation_text = data.annotations[0].annotation, add_line = false);\n  \n  const annotation_two = plot_annotations(\n    svg, \n    margin, \n    x_placement = new Date(data.annotations[1].months), \n    y_placement = data.annotations[1].gold_certificates_in_treasury_cash, \n    annotation_text = data.annotations[1].annotation, \n    add_line = true,\n    align = \"left\",\n    color = \"standard\");\n  \n  const annotation_three = plot_annotations(\n    svg, \n    margin, \n    x_placement = new Date(data.annotations[2].months), \n    y_placement = data.annotations[2].gold_certificates_in_treasury_cash, \n    annotation_text = data.annotations[2].annotation, \n    add_line = true);\n  \n  const y_label = plot_y_label(svg, margin);\n  const source_label = plot_source(svg, margin);\n  \n  \n  // Bars\n  const bars = plot_bar(svg, margin, data);\n  const highlight = plot_highlight(svg, margin, data);\n  \n  return svg.node();\n}\n\n/* R2D3 Source File:  D3/plot_source.js */\nfunction plot_source(svg, margin) {\n  \n  svg.append(\"text\")\n  .attr(\"class\", \"text-source\")\n  .attr(\"x\", width - 10)\n  .attr(\"y\", height - 10)\n  .text(\"U.S. Treasury's Report of Financial Panic of 1893\");\n  \n}\n\n/* R2D3 Source File:  D3/plot_x_axis.js */\nfunction plot_x_axis(svg, margin, min_date, max_date, x_tick_count) {\n  \n  \n  const timeFormat = d3.utcFormat(\"%y %b\");\n  \n  const x = d3.scaleTime()\n  .domain([min_date, max_date])\n  .range([margin.left, width - margin.right]);\n  \n  const tickValues = x.ticks(x_tick_count); \n  \n  if (tickValues[tickValues.length - 1] < max_date) {\n    tickValues.push(max_date);\n  }\n  \n  const x_axis = d3.axisBottom(x)\n  .tickValues(tickValues)\n  .tickFormat(timeFormat);\n  \n  svg.append(\"g\")\n  .attr(\"class\", \"x-axis\")\n  .attr(\"transform\", `translate(0, ${height - margin.bottom})`)\n  .call(x_axis);\n  \n  return x;\n  \n}\n\n/* R2D3 Source File:  D3/plot_y_label.js */\nfunction plot_y_label(svg, margin) {\n  \n  svg.append(\"text\")\n  .attr(\"class\", \"axis-label\")\n  .attr(\"x\", -(height / 2))\n  .attr(\"y\", margin.left - 70)\n  .attr(\"transform\", \"rotate(-90)\")\n  .attr(\"text-anchor\", \"middle\")\n  .append(\"tspan\")\n  .text(\"Gold Certificates in U.S. Treasury\") \n  .append(\"tspan\")\n  .attr(\"x\", -(height / 2))\n  .attr(\"dy\", \"1.2em\") \n  .style(\"font-style\", \"italic\") \n  .text(\"(millions)\");\n  \n}\n\n/* R2D3 Source File:  D3/plot_yaxis.js */\nfunction plot_yaxis(svg, margin, minY, maxY, width) {\n  \n  const roundedMaxY =  Math.ceil(maxY / 1000000) * 1000000;\n  const tickMajorInterval = roundedMaxY / 5;\n  const tickMinorInterval = tickMajorInterval / 2;\n  const tickMajorValues = d3.range(0, roundedMaxY + tickMajorInterval, tickMajorInterval);\n  const tickMinorValues = d3.range(0, roundedMaxY + tickMinorInterval, tickMinorInterval);\n  \n  const y = d3.scaleLinear()\n  .domain([minY, roundedMaxY]) \n  .range([height - margin.bottom, margin.top]);\n  \n  const yAxis = d3.axisLeft(y)\n  .tickValues(tickMajorValues)\n  .tickFormat(d => `$${d / 1000000}`); ;\n  \n  const yGridLine = d3.axisLeft(y)\n  .tickValues(tickMajorValues)\n  .tickFormat(\"\")\n  .tickSize(-(width - margin.right - margin.left)); ;\n  \n  \n  svg.append(\"g\")\n  .attr(\"class\", \"y-axis\")\n  .attr(\"transform\", `translate(${margin.left}, 0)`)\n  .call(yAxis);\n  \n  svg.append(\"g\")\n  .attr(\"class\", \"y-axis\")\n  .attr(\"transform\", `translate(${margin.left}, 0)`)\n  .style(\"opacity\", .10)\n  .call(yGridLine);\n  \n  return y; \n  \n}\n};","style":"/* R2D3 Source File:  D3/custom.css */\nsvg {\n  font-family: \"Source Sans 3\";\n}\n\n.highlight {\n  fill: #AC882A;\n}\n\nline.highlight  {\n  stroke: #AC882A;\n  stroke-width: 1;\n}\n\n.standard {\n  fill: #373735;\n}\n\nline.standard {\n  stroke: #373735;\n}\n\n.y-axis, .x-axis {\n  font-family: \"Source Sans 3\";\n  font-weight: 300;\n  font-size: .8em;\n}\n\n.header-primary {\n  font-size: 2em;\n  font-weight: 400;\n  fill: #373735;\n}\n\n.header-primary-medium {\n  font-size: 1.5em;\n  font-weight: 400;\n  fill: #373735;\n}\n\n.header-primary-small {\n  font-size: 1em;\n  font-weight: 400;\n  fill: #373735;\n}\n\n.header-secondary {\n  font-size: 1.5em;\n  font-weight: 300;\n  fill: #373735;\n}\n\n.header-secondary-medium {\n  font-size: 1.25em;\n  font-weight: 300;\n  fill: #373735;\n}\n\n.header-secondary-small {\n  font-size: .75em;\n  font-weight: 300;\n  fill: #373735;\n}\n.axis-label {\n  font-weight: 300;\n  fill: #373735; \n}\n\n.text-annotation {\n  font-weight: 500;\n}\n\n.text-source {\n  font-weight: 300;\n  font-style: italic;\n  font-size: 1em;\n  text-anchor: end;\n}","version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Equally imporant, this tutorial also teaches you how to think about modularization and file structure, so that you know how to set up your projects to use these visualizations.</p>
<p>I think one of the reason D3 is so overwhelming is that, unlike ggplot2, it requires modularization (i.e., smaller functions) to keep the code oragnizaed and easy to maintain. For that reason, I build that concept into the lesson.</p>
<p><em>Building a D3 visualization is about as much work as building a Shiny application!</em></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
D3 is frickin’ cool!
</div>
</div>
<div class="callout-body-container callout-body">
<p>D3 provides more opportunities to build smoething cool than any other data viz framework I know of.</p>
<p>It is largely teh domain of hobbyists, but those who really value creative fulfillment, it’s a great skill to invest in. The biggest publications (WSJ, New York Times, etc.) heavily rely on D3 to present information in a novel and interactive way.</p>
<p>(show gif)</p>
</div>
</div>
</section>
<section id="teaching-a-foundation" class="level2">
<h2 class="anchored" data-anchor-id="teaching-a-foundation">Teaching a Foundation</h2>
<p>Don’t think though that this doesn’t build towards your larger goal of building more complex data visualizations, or exploring other data viz types. This tutorial teaches the key foundational concepts.</p>
<p>The primary ones relate to:</p>
<ul>
<li><p>Margins</p></li>
<li><p>Range</p></li>
<li><p>Domain</p></li>
<li><p>Width</p></li>
</ul>
<p>The secondary concept to learn is to write smaller functions to tackle each individual part of the data visualization. The one we’re working on has X number. Nearly every single one relies on the margin, range, and domain to some degree. Most wouldn’t work without them.</p>
<p>You can see how changing margin, range, and domain operates with this Shiny App.</p>
<p>This tutorial takes you through annotations, headers, and other aesthetic choices that often make D3 look more professional. Learning these little quarks will give you more options in making more advanced visuals.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
D3 is frickin’ hard!
</div>
</div>
<div class="callout-body-container callout-body">
<p>D3 is without a doubt the hardest programming framework I have ever learned.</p>
<p>It’s also quite touchy. It doesn’t do anything you didn’t ask it to do, and that also means a lack of robust error messages.</p>
<p>Directory names, function names, parameters, etc. are all things that will cause your script to not render.</p>
<p>So be patient with yourself. I have sometimes spent hours searching for an issue to only find out it was a simple parameter name.</p>
<p>You may go through this tutorial completely confused. I provide checkpoints along the way so that you can copy and paste scripts in their entirety to better understand where you miss something.</p>
<p>Concepts may not solidify either the first time around. I try my best to reduce that burden.</p>
</div>
</div>
</section>
<section id="what-this-tutorial-skips" class="level2">
<h2 class="anchored" data-anchor-id="what-this-tutorial-skips">What This Tutorial Skips</h2>
<p>One area of D3 relates to its data transformation functions, which are impressive and robust. I won’t have time to cover this in this tutorial and I personally stick to good ol’ <code>tidyverse</code> in R for most data prep.</p>
<p>The one thing you should do though is rely on <code>list</code> to organize your data. Note though that this data is not limited to the data being presented, but other data points, such as annotations.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ChatGPT is quite good!
</div>
</div>
<div class="callout-body-container callout-body">
<p>I actually have better luck asking ChatGPT questions than I do consulting with D3 documentation. I believe the reason is ChatGPT has to know how to crawl the internet, so HTML, CSS, and JavaScript are skills it learned quite well.</p>
<p>I also find that ChatGPT is better at D3 than R and R Shiny.</p>
<p>That said, it is still better when asking narrow questions.</p>
</div>
</div>
</section>
<section id="recommended-create-a-mockup" class="level2">
<h2 class="anchored" data-anchor-id="recommended-create-a-mockup">Recommended: Create a Mockup</h2>
<p>Normally, I think it overkill to create a mockup of a single data visualization. However, it’s actually a good idea when it comes to D3.</p>
<p>One simple reason is that it helps keep you inspired, since you won’t see the fruit of your work right away.</p>
<p>The second reason is that D3 requires such minute coding that it doesn’t allow for as much iteration, especially when it comes to aesthetics and interactivity.</p>
<p>We’ll be building something simple today, so the mockup’s primary benefit will be for us to pick colors and aesthetics up front.</p>
<p>(show mockup)</p>
</section>
<section id="create-r-script" class="level2">
<h2 class="anchored" data-anchor-id="create-r-script">Create R Script</h2>
<p>Create an R script called <code>scrap.R</code>. This is where we’ll run evolving R code as we proceed through the tutorial.</p>
<p>Place the following at the top:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="our-data-set" class="level2">
<h2 class="anchored" data-anchor-id="our-data-set">Our Data Set</h2>
<p>We’ll be using the <code>freeStateData</code> package’s <code>us_treasury_data_1890s</code> data set for this visualization. This package (built by yours truly) contains economic history data (for now). I periodically update it with data I find interesting. (Feel free to use it for other projects too).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"https://github.com/Free-State-Analytics/freeStateData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Place and run the following in your <code>scrap.R</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(freeStateData)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"us_treasury_data_1890s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can run <code>?us_treasury_data_1890s</code> to see more information on this data set.</p>
<p>We’re gonna rename this to <code>dGold</code> for now and reduce the data to something simpler.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dGold <span class="ot">&lt;-</span> us_treasury_data_1890s <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.Date</span>(year_month) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"1892-11-01"</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">as.Date</span>(year_month) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"1893-12-31"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"year_month"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"gold_certificates_in_treasury_cash"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> year_month,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">gold_in_cash =</span> gold_certificates_in_treasury_cash)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dGold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date gold_in_cash
1 1892-11-01     19632830
2 1892-12-01     24254750
3 1893-01-01     15729770
4 1893-02-01      7782260
5 1893-03-01      5135430
6 1893-04-01      8888310</code></pre>
</div>
</div>
</section>
<section id="transforming-to-json" class="level2">
<h2 class="anchored" data-anchor-id="transforming-to-json">Transforming to JSON</h2>
<p>R data.frame is not what we need for D3. D3 relies on JSON structures.</p>
<p>Use <code>jsonlite::toJSON</code> to transform <code>dGold</code>. Assign the JSON file the name <code>jGold</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>jGold <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">toJSON</span>(dGold)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>jGold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{"date":"1892-11-01","gold_in_cash":19632830},{"date":"1892-12-01","gold_in_cash":24254750},{"date":"1893-01-01","gold_in_cash":15729770},{"date":"1893-02-01","gold_in_cash":7782260},{"date":"1893-03-01","gold_in_cash":5135430},{"date":"1893-04-01","gold_in_cash":8888310},{"date":"1893-05-01","gold_in_cash":3324670},{"date":"1893-06-01","gold_in_cash":1071170},{"date":"1893-07-01","gold_in_cash":93710},{"date":"1893-08-01","gold_in_cash":565370},{"date":"1893-09-01","gold_in_cash":129220},{"date":"1893-10-01","gold_in_cash":115860},{"date":"1893-11-01","gold_in_cash":149090},{"date":"1893-12-01","gold_in_cash":75590}] </code></pre>
</div>
</div>
</section>
<section id="create-primary-plot-javascript-function" class="level2">
<h2 class="anchored" data-anchor-id="create-primary-plot-javascript-function">Create Primary Plot JavaScript Function</h2>
<p>In your directory…</p>
<ol type="1">
<li>Create a folder called <code>D3</code></li>
<li>Using Posit Cloud’s “D3 Script” example, save a script called <code>plot_main.js</code> within the <code>D3/</code> directory</li>
</ol>
<p>You should see it render in your Viewer immediately.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why `plot_main.js`?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The length of code in a single D3 data visualization will get overwhelming fast. This makes it much more difficult to trouble shoot.</p>
<p>For that reason, we have a single script that will contain more specialized scripts in the future.</p>
</div>
</div>
</section>
<section id="create-render-plot-r-function" class="level2">
<h2 class="anchored" data-anchor-id="create-render-plot-r-function">Create Render Plot R Function</h2>
<p>In <code>scrap.R</code>, add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="fl">0.40</span>, <span class="fl">0.20</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="st">"D3/plot_main.js"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="r2d3 html-widget html-fill-item" id="htmlwidget-3d44d05c2389ac931793" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3d44d05c2389ac931793">{"x":{"data":[0.3,0.6,0.8,0.95,0.4,0.2],"type":"numeric","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/cloud/project/D3/plot_main.js\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is svg?
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you notice, our <code>plot_main.js</code> currently references an object called <code>svg</code>.</p>
<p><code>r2d3</code> generates an svg div in HTML by default. Any further code we write appends to this div or modifies it.</p>
<p>The wiki definition for svg is: Scalable Vector Graphics is an XML-based vector image format for defining two-dimensional graphics, having support for interactivity and animation.</p>
</div>
</div>
</section>
<section id="checkpoint" class="level2">
<h2 class="anchored" data-anchor-id="checkpoint">Checkpoint!</h2>
<p>We’re going to provide check points frequently now. Things are about to get super hard! Check to make sure your <code>scrap.R</code> file matches below and that the D3 visualizatoin renders to your Viewer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(freeStateData)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"us_treasury_data_1890s"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>dGold <span class="ot">&lt;-</span> us_treasury_data_1890s <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"year_month"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"gold_certificates_in_treasury_cash"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> year_month,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gold_in_cash =</span> gold_certificates_in_treasury_cash)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>jGold <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">toJSON</span>(dGold)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>jGold</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">r2d3</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="fl">0.40</span>, <span class="fl">0.20</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="st">"D3/plot_main.js"</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="swap-out-data" class="level2">
<h2 class="anchored" data-anchor-id="swap-out-data">Swap Out Data</h2>
<p>Building a D3 visualizations means building pieces that won’t necessarily appear yet. Have faith in the process, but also follow instructions closely. If it helps, copy and paste the code you see directly from this tutorial.</p>
<p>First, let’s replace our <code>data</code> parameter in <code>r2d3</code> with <code>jGold</code> in our <code>scrap.R</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r2d3</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> jGold,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="st">"D3/plot_main.js"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will make the rendering unavailable for the time being.</p>
</section>
<section id="creating-y-axis" class="level2">
<h2 class="anchored" data-anchor-id="creating-y-axis">Creating Y-Axis</h2>
<p>Now that we’re feeding proper data to our D3 plot, let’s add the axises. We’re going to start with the y-axis, because the formatting is easier to understand and it’ll help ease us into the key concepts.</p>
<p>There are actually four stages to producing an axis:</p>
<ol type="1">
<li>Define the min and max value for your axis</li>
<li>Define the dimensions of the axis</li>
<li>Define aesthetics of the axis</li>
<li>Append axis to your svg</li>
</ol>
<p>The variables or “bindings” in one stage are referenced in the next.</p>
<p>That’s a lot of work for just one axis, right?</p>
<p>And each steps has lots of fine little nuances that if you do wrong, nothing works!</p>
<section id="define-min-and-max-value-for-axis" class="level3">
<h3 class="anchored" data-anchor-id="define-min-and-max-value-for-axis">Define Min and Max Value for Axis</h3>
<p>We’re going to hard code the min and max vlaue for our axis in this tutorial. Looking at <code>max(dGold$gold_in_cash)</code>, we see that the max value is <code>37721280</code>. We’re going to round up to <code>37500000</code> for this tutorial, but you can use D3’s robust data prep functions to dynamically select the max value.</p>
<p>Within <code>plot_main.js</code>, we’re going to delete everything and add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>const</code> is a “binding” in JavaScript that makes it easier to pass around values, much in the same way an object name does in R.</p>
</section>
<section id="define-dimensions-of-the-axis" class="level3">
<h3 class="anchored" data-anchor-id="define-dimensions-of-the-axis">Define Dimensions of the Axis</h3>
<p>We’re going to create another binding which defines the dimensions the axis should follow. We’ll call it <code>y_dimension</code>.</p>
<p>We’ll have to define the type of axis we’re defining. In this example, we are looking at numeric data with a linear scale. So we’ll use <code>d3.scaleLinear</code>.</p>
<p>You can see all the options for D3’s scales here <strong>provide link</strong></p>
<p>In <code>plot_main.js</code>, add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That doesn’t do anything though. We have to define the dimensions, which rely crucially on two key concepts mentioned at the start of the tutorial: domain and range.</p>
<p><strong>Domain</strong> is the dimension in relation to the actual data (i.e., the min value and the max value of interest). We pass a JavaScript array to the <code>.domain()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can tell, an <a href="https://eloquentjavascript.net/04_data.html#h-k6fyJHbpdU">array in JavaScript</a> is not like an array in R.</p>
<p><strong>Range</strong> is the dimension in relation to the SVG (i.e., how far does the axis traverse across the overall image).</p>
<p>We will pass an array <code>[0, height]</code> through <code>.range()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> height])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>height</code> is a default variable added to your D3 script via <code>r2d3</code>. It basically encompasses the entire view port available.</p>
<p>Your complete <code>plot_main.js</code> up to this point should look like the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> height])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Keep in mind, you won’t see anything yet in your Viewer window.</p>
</section>
<section id="define-aesthetics" class="level3">
<h3 class="anchored" data-anchor-id="define-aesthetics">Define Aesthetics</h3>
<p><code>y_dimension</code> defines how the data will place itself in relation to the SVG. It does not really define how axis itself will appear. That is what our next binding <code>y_aesthetics</code> will do.</p>
<p>We’ll pass <code>y_dimension</code> as a param to D3’s <code>axisLeft()</code>. This first defines that we want the axis to be treated as left axis, which passes defaults to the labels of interest.</p>
<p>You can read more about axises here: <strong>provide link</strong></p>
<p>In <code>plot_main.js</code>, add the following at the bottom:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will be sprucing <code>y_aesthetic</code> up further later, but for now, we’re going to rely on defaults.</p>
</section>
<section id="append-axis-to-svg" class="level3">
<h3 class="anchored" data-anchor-id="append-axis-to-svg">Append Axis to SVG</h3>
<p>We built bindings that will inform D3 what we want to see in our axis. However, we haven’t updated our SVG yet to use this information.</p>
<p>In <code>plot_main.js</code>, add the following to the bottom:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This appends a <code>g</code> div to your <code>svg</code>. You then call your <code>y_aesthetic</code> binding, which references your <code>y_dimension</code> binding, which references your <code>y_min</code> and <code>y_max</code> binding, to inform the new <code>g</code> what it should look like.</p>
<p>Your complete <code>plot_main.js</code> script should look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> height])<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)<span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now run the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> jGold,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="st">"D3/plot_main.js"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-margin" class="level3">
<h3 class="anchored" data-anchor-id="adding-margin">Adding Margin</h3>
<p>If you notice, our line is at the far edge. There are actual labels on our axis, but we can’t see them.</p>
<p>Let’s move our axis to the right by adding some margin space. We can do this by modify Stage Four’s <code>svg.append()</code> function and adding a CSS attribute that says “transform” by nudging <strong><em>100 pixels to the right</em></strong>.ISthisright?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(100, 0)`</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="flipping-our-axis" class="level3">
<h3 class="anchored" data-anchor-id="flipping-our-axis">Flipping Our Axis</h3>
<p>Now re-run your <code>r2d3</code> script in <code>scrap.R</code>. Notice anything funny?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> jGold,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="st">"D3/plot_main.js"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="r2d3 html-widget html-fill-item" id="htmlwidget-0e9ae7af3b718db0efcc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0e9ae7af3b718db0efcc">{"x":{"data":[{"date":"1892-11-01","gold_in_cash":19632830},{"date":"1892-12-01","gold_in_cash":24254750},{"date":"1893-01-01","gold_in_cash":15729770},{"date":"1893-02-01","gold_in_cash":7782260},{"date":"1893-03-01","gold_in_cash":5135430},{"date":"1893-04-01","gold_in_cash":8888310},{"date":"1893-05-01","gold_in_cash":3324670},{"date":"1893-06-01","gold_in_cash":1071170},{"date":"1893-07-01","gold_in_cash":93710},{"date":"1893-08-01","gold_in_cash":565370},{"date":"1893-09-01","gold_in_cash":129220},{"date":"1893-10-01","gold_in_cash":115860},{"date":"1893-11-01","gold_in_cash":149090},{"date":"1893-12-01","gold_in_cash":75590}],"type":"json","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/cloud/project/D3/plot_main.js\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>This is how touchy little arguments are with regards to D3. What happened is that we mapped our range <code>[0, height]</code> to our domain <code>[y_min, y_max]</code> by saying that <code>0</code> corresponds to <code>y_min</code>. Really, we want <code>0</code> to correspond to <code>y_max</code>.</p>
<p>We can modify <code>y_dimension</code> to account for this:</p>
<div class="cell">
<script>
// Stage Two: Define dimensions
const y_dimension = d3.scaleLinear()
  .domain([y_min, y_max])
  .range([height, 0]);
</script>
</div>
<p>And our complete <code>plot_main.js</code> script is like so:</p>
<div class="cell">
<script>
// Stage One: Define min and max values of interest
const y_min = 0;
const y_max = 37500000;

// Stage Two: Define dimensions
const y_dimension = d3.scaleLinear()
  .domain([y_min, y_max])
  .range([height, 0]);
 
// Stage Three: Define aesthetics
const y_aesthetic = d3.axisLeft(y_dimension);

// Stage Four: Append to SVG
svg.append("g")
  .attr("transform", `translate(100, 0)`)
  .call(y_aesthetic);
</script>
</div>
</section>
</section>
<section id="creating-x-axis" class="level2">
<h2 class="anchored" data-anchor-id="creating-x-axis">Creating X-Axis</h2>
<p>We have one axis done! Quite a bit of work, right? Now we’ll have to add the x-axis.</p>
<p>Once again, we’ll have four stages:</p>
<ol type="1">
<li>Define the min and max value for your axis</li>
<li>Define the dimensions of the axis</li>
<li>Define aesthetics of the axis</li>
<li>Append axis to your svg</li>
</ol>
<section id="define-min-and-max-value-for-axis-1" class="level3">
<h3 class="anchored" data-anchor-id="define-min-and-max-value-for-axis-1">Define Min and Max Value for Axis</h3>
<p>Much like the y-axis, we want to hardcode our values for now. Unlike the y-axis, we’ll pick specific values rather than select the values found in the data set.</p>
<p>We want our min date to be <code>1892-11-01</code> and max date to be <code>1893-12-31</code>.</p>
<p>However, we’ll have to translate those values to be something JavaScript can understand. (This is a good example of ChatGPT being helpful.)</p>
<p>Within <code>plot_main.js</code>, place the following near the bottom of the script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest  </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_min <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1892-11-01"</span>)<span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_max <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1893-12-31"</span>)<span class="op">;</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-dimensions-of-the-axis-1" class="level3">
<h3 class="anchored" data-anchor-id="define-dimensions-of-the-axis-1">Define Dimensions of the Axis</h3>
<p>Much like before, we’re gonna create a binding called <code>x_dimension</code> to define the dimensiosn of our x-axis. Unlike before, we have to use a different scale. Since this relates to datetimes, we’ll use <code>d3.scaleTime</code>. You can see all the options for D3’s scales here <strong>provide link</strong></p>
<p>In <code>plot_main.js</code>, add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleTime</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll define our <code>.domain</code> in a similar way as before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And our range using <code>width</code> instead. (Notice that <code>width</code> needs to correspond to <code>x_max</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> width])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>width</code> is a default variable added to your D3 script via <code>r2d3</code>, much like <code>height</code>. It covers the width of the viewport and makes D3 data visualizations dynamic when they resize.</p>
</section>
<section id="define-aesthetics-1" class="level3">
<h3 class="anchored" data-anchor-id="define-aesthetics-1">Define Aesthetics</h3>
<p>Our next binding <code>x_aesthetic</code> will be similar to before, only we will use <code>axisBottom</code>.</p>
<p>You can read more about axises here: <strong>provide link</strong></p>
<p>In <code>plot_main.js</code>, add the following at the bottom:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will be sprucing <code>y_aesthetic</code> up further later, but for now, we’re going to rely on defaults.</p>
</section>
<section id="append-axis-to-svg-1" class="level3">
<h3 class="anchored" data-anchor-id="append-axis-to-svg-1">Append Axis to SVG</h3>
<p>Finally, we need to append our SVG.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our complete <code>plot_main.js</code> script should look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([height<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)<span class="op">;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(100, 0)`</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest  </span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_min <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1892-11-01"</span>)<span class="op">;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_max <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1893-12-31"</span>)<span class="op">;</span>  </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> width])<span class="op">;</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="there-is-a-lot-wrong-here" class="level3">
<h3 class="anchored" data-anchor-id="there-is-a-lot-wrong-here">There Is a Lot Wrong Here</h3>
<p>When you re-run your <code>scrap.R</code> file, we find a lot wrong with the rendering.</p>
<p>Much of this has to do with margins. Some of it has to do with the values used in <code>x_aesthetic</code> and <code>y_aesthetic</code>.</p>
<p>Also, our script is getting long. We’ll need to slim that down.</p>
<p>We’re gonna tackle the margins for now.</p>
</section>
</section>
<section id="define-and-pass-margins" class="level2">
<h2 class="anchored" data-anchor-id="define-and-pass-margins">Define and Pass Margins</h2>
<p><strong>Margins</strong> are a key concept in D3 that will show up a lot. Most tutorials you’ll find have margins as a default value. And it’s important to define them in once place because you use them everywhere!</p>
<p>For that reason, it’s best to define them in one place.</p>
<p>At the top of <code>plot_main.js</code>, add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we need to adjust the x- and y-axis to use these margins.</p>
<p>Let’s line up the left margin first.</p>
<section id="modify-x--and-y-axis-to-use-margin.left" class="level3">
<h3 class="anchored" data-anchor-id="modify-x--and-y-axis-to-use-margin.left">Modify X- and Y-Axis to Use <code>margin.left</code></h3>
<p>Modify the “transform” attribute for our <code>g</code> div for the y-axis like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now modify <code>x_dimension</code> to do the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why did we add `margin.left` in differnet places for x- and y-axis?
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may have noticed that we updated the <code>range()</code> for the x-axis to use <code>margin.left</code>, but updated the attribute of <code>g</code> div for our y-axis. Why?</p>
<p>Well, it has to do with what these are working on. <code>y_dimension</code> focused on defining how our future bar graph will expand and contract vertically. That means it doesn’t need to think about where it goes on the x-axis. However, we want to change its x-axis position. We do that by changing where <code>g</code> is placed.</p>
<p>Oppositely, <code>x_dimension</code> is concerned with how our future bar graph will interpret data on a horizontal scale. <code>margin.left</code> is crucial for determining that placement. So we have to use that information in the <code>range</code>.</p>
</div>
</div>
</section>
<section id="aside-modify-x-axis-to-be-on-bottom" class="level3">
<h3 class="anchored" data-anchor-id="aside-modify-x-axis-to-be-on-bottom">Aside: Modify X-Axis to Be on Bottom</h3>
<p>This isn’t quite rleated to the margins, but now that we better understand how attribute rela</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you run this though, our x-axis disappears entirely! We have to add our other margins.</p>
</section>
<section id="modify-x--and-y-axis-to-use-other-margins" class="level3">
<h3 class="anchored" data-anchor-id="modify-x--and-y-axis-to-use-other-margins">Modify X- and Y-Axis to Use Other Margins</h3>
<p>asdga</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>asdgasdg</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>asdgag</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our complete `<code>plot_main.js`</code> script so far should look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span>}</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)<span class="op">;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage One: Define min and max values of interest  </span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_min <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1892-11-01"</span>)<span class="op">;</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_max <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1893-12-31"</span>)<span class="op">;</span>  </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Still want to learn D3? :)</p>
</section>
</section>
<section id="begin-to-modularize" class="level2">
<h2 class="anchored" data-anchor-id="begin-to-modularize">Begin to Modularize</h2>
<p>Our script is getting longer. It’s getting more confusing. Thankfully, we can start to modularize it. No, we’re not gonna have to learn namespacing like we do in R Shiny, but we are gonna use a similar concept and make everythign smaller.</p>
<p>We’re gonna move our x- and y-axis scripts into indiviual functions out of <code>plot_main.js</code>. We’re gonna call them:</p>
<ol type="1">
<li><code>plot_x_axis.js</code></li>
<li><code>plot_y_axis.js</code></li>
</ol>
<p>We’re also gonna modify our <code>r2d3</code> script to use those new files and create a callable function to make it easier to render.</p>
<section id="create-plot_x_axis.js" class="level3">
<h3 class="anchored" data-anchor-id="create-plot_x_axis.js">Create <code>plot_x_axis.js</code></h3>
<p>agak;g</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage One: Define min and max values of interest  </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_min <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1892-11-01"</span>)<span class="op">;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_max <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1893-12-31"</span>)<span class="op">;</span>  </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-plot_y_axis.js" class="level3">
<h3 class="anchored" data-anchor-id="create-plot_y_axis.js">Create <code>plot_y_axis.js</code></h3>
<p>agak;g</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)<span class="op">;</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modify-plot_main.js" class="level3">
<h3 class="anchored" data-anchor-id="modify-plot_main.js">Modify <code>plot_main.js</code></h3>
<p>And here is updated <code>plot_main.js</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span>}<span class="op">;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create x- and y-axis</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin)<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll have to update our <code>r2d3</code> script to use these additional files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> jGold,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> <span class="fu">c</span>(<span class="st">"D3/plot_main.js"</span>, <span class="st">"D3/plot_x_axis.js"</span>, <span class="st">"D3/plot_y_axis.js"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You don’t have to define svg and margin
</div>
</div>
<div class="callout-body-container callout-body">
<p>Unlike R, you don’t actually need to define svg and margin as parameters. JavaScript will treat them universally. However, I believe it’s best to be explicit in what you’re doing, mostly for readability sake.</p>
</div>
</div>
</section>
<section id="create-plot_gold_viz" class="level3">
<h3 class="anchored" data-anchor-id="create-plot_gold_viz">Create <code>plot_gold_viz</code></h3>
<p>It is getting tedious to re-run <code>r2d3</code> over and over again. And it’ll get to be even more tedious as we add more <code>.js</code> files.</p>
<p>We can made a single R function that both searches for all .js files and produces the data viz.&nbsp;I’m not going to define this too much since we’re primarily focused on learning D3.</p>
<p>Save the following in R/<code>plot_gold_viz.R</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot_gold_viz <span class="ot">&lt;-</span> <span class="cf">function</span>(jGold, <span class="at">directory_path =</span> <span class="st">"Cloud/project/D3"</span>) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> directory_path, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  js_scripts <span class="ot">&lt;-</span> file_list[<span class="fu">grepl</span>(<span class="st">".js"</span>,file_list)]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> jGold,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">script =</span> <span class="fu">paste0</span>(<span class="st">"D3/"</span>,js_scripts)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now update your <code>scrap.R</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(freeStateData)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"us_treasury_data_1890s"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>dGold <span class="ot">&lt;-</span> us_treasury_data_1890s <span class="sc">%&gt;%</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"year_month"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"gold_certificates_in_treasury_cash"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> year_month,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gold_in_cash =</span> gold_certificates_in_treasury_cash)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>jGold <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">toJSON</span>(dGold)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/plot_gold_viz.R"</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gold_viz</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now all you have to do is run <code>plot_gold_viz()</code> and your D3 viz will take any additional <code>.js</code> files required.</p>
</section>
</section>
<section id="improve-axis-tick-labels" class="level2">
<h2 class="anchored" data-anchor-id="improve-axis-tick-labels">Improve Axis Tick Labels</h2>
<p>Right now, neither of our axis tick labels look very good. The dates don’t look like dates at all. The numbers on the right are too big.</p>
<p>Being largely an aesthetic consideration, unrelated to the actual scaling of data to size of the axis and the SVG, we are naturally going to update <code>y_aesthetic</code> and <code>x_aesthetic</code>.</p>
<section id="updating-x-axis-tick-label" class="level3">
<h3 class="anchored" data-anchor-id="updating-x-axis-tick-label">Updating X-Axis Tick Label</h3>
<p>The x-axis needs a time formatter to create a biding with teh appropriate labels. <a href="https://d3js.org/d3-time-format" class="uri">https://d3js.org/d3-time-format</a></p>
<p>We then have to update the tick’s format with this formatter binding. <a href="https://d3js.org/d3-axis#axis_tickFormat" class="uri">https://d3js.org/d3-axis#axis_tickFormat</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> format_date <span class="op">=</span> d3<span class="op">.</span><span class="fu">utcFormat</span>(<span class="st">"%y %b"</span>)<span class="op">;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">tickFormat</span>(format_date)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="updating-y-axis-tick-label" class="level3">
<h3 class="anchored" data-anchor-id="updating-y-axis-tick-label">Updating Y-Axis Tick Label</h3>
<p>The y-axis does not need to use the specialized <code>utcFormat</code> function. It’ll use D3’s <code>format</code> to first turn the label into a currency and then apply that binding using <code>tickFormat()</code>.</p>
<p>This is made useless by the fact that we want to present our numbers at “M”. So I find it easier to simply attach the “$” and “M” directly to it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> format_currency <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">"($"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">tickFormat</span>(d <span class="kw">=&gt;</span> <span class="fu">format_currency</span>(d <span class="op">/</span> <span class="dv">1000000</span>) <span class="op">+</span> <span class="st">"M"</span>)<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Alternative</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">tickFormat</span>(d <span class="kw">=&gt;</span> <span class="st">"$"</span> <span class="op">+</span> (d <span class="op">/</span> <span class="dv">1000000</span>) <span class="op">+</span> <span class="st">"M"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="adding-shapes" class="level2">
<h2 class="anchored" data-anchor-id="adding-shapes">Adding Shapes</h2>
<p>D3 visualizations rely heavily on shapes for most standard data visualizations. Shapes are drawings that take instructions from the data you pass it. Since we defined the margins, domain, and range with our current functions, they know where to place themselves in relation to the x and y axis.</p>
<p><a href="https://d3js.org/d3-shape" class="uri">https://d3js.org/d3-shape</a></p>
<p>If you think there is perfect consistency in how these shapes are produced, prepare to be semi-disappointed.</p>
</section>
<section id="create-bar-shape" class="level2">
<h2 class="anchored" data-anchor-id="create-bar-shape">Create Bar Shape</h2>
<p>We’re gonna start with a bar graph. In your <code>D3/</code> directory, create <code>plot_bar.js</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may notice that we have four parameters to pass to this JS function. Two look quite familiar.</p>
<p>In order for us to simply pass those two, we need to turn them into bindings that canb e passed as parameters.</p>
<section id="modularize-x_dimension-and-y_dimension" class="level3">
<h3 class="anchored" data-anchor-id="modularize-x_dimension-and-y_dimension">Modularize <code>x_dimension</code> and <code>y_dimension</code></h3>
<p>Unfortunately, <code>x_dimension</code> and <code>y_dimension</code> are not yet available. We could modify <code>plot_axis_y</code> and <code>plot_x_axis</code> to return them. However, this may confused the purpose those functions in our <code>plot_main.js</code> script.</p>
<p>So let’s separate those out!</p>
<p>Create two additional files in your <code>D3/</code> directory.</p>
<p>One called <code>plot_x_dimension.js</code> …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_x_dimension</span>() {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage One: Define min and max values of interest  </span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_min <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1892-11-01"</span>)<span class="op">;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_max <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"1893-12-31"</span>)<span class="op">;</span>  </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([x_min<span class="op">,</span> x_max])</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x_dimension<span class="op">;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>… and the other <code>plot_y_dimension.js</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_y_dimension</span>() {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage One: Define min and max values of interest</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_max <span class="op">=</span> <span class="dv">37500000</span><span class="op">;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Two: Define dimensions</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_dimension <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([y_min<span class="op">,</span> y_max])</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y_dimension<span class="op">;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll have to modify <code>plot_main.js</code> to use define the binding.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span>}<span class="op">;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create x and y dimensions</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> <span class="fu">plot_x_dimension</span>(svg<span class="op">,</span> margin)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> <span class="fu">plot_y_dimension</span>(svg<span class="op">,</span> margin)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Create x- and y-axis</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> x_dimension)<span class="op">;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> y_dimension)<span class="op">;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Add line</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_line</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll need to modify our <code>plot_x_axis</code> and <code>plot_y_axis</code> to use this as a parameter.</p>
<p>Here is <code>plot_x_axis.js</code>…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> x_dimension) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format_date <span class="op">=</span> d3<span class="op">.</span><span class="fu">utcFormat</span>(<span class="st">"%y %b"</span>)<span class="op">;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(format_date)<span class="op">;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x_dimension<span class="op">;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…and here is <code>plot_y_axis.js</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> y_dimension) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(d <span class="kw">=&gt;</span> <span class="st">"$"</span> <span class="op">+</span> (d <span class="op">/</span> <span class="dv">1000000</span>) <span class="op">+</span> <span class="st">"M"</span>)<span class="op">;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your <code>plot_main.js</code> should now look like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span>}<span class="op">;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create x and y dimensions</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> x_dimension <span class="op">=</span> <span class="fu">plot_x_dimension</span>(margin)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> y_dimension <span class="op">=</span> <span class="fu">plot_y_dimension</span>(margin)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Create x- and y-axis</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> x_dimension)<span class="op">;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> y_dimension)<span class="op">;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Add bar</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="back-to-plot_bar.js" class="level3">
<h3 class="anchored" data-anchor-id="back-to-plot_bar.js">Back to <code>plot_bar.js</code></h3>
<p>Back to our empty <code>plot_bar.js</code> function. This is where D3 begins to require counter-intuitive scripting.</p>
<p>First, we <code>selectAll("gold-bar")</code>, which looks for any tag with the name of “gold-bar.”</p>
<p>No such tag exists yet, but that’s okay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we “map” our data to the selection of tag named “gold-bar,” despite no such tag existing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the data knows that it has nothing to map itself to, because again, “gold-bar” does nto exist.</p>
<p>So we need to inform data that we’re going to pass it something new to map itself to. We use <code>enter()</code> to start that process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But what will we map it to? Rectangles! Which is what a bar graph really is made of.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A rectangle’s placement is based on each <code>date</code> (x-axis) and <code>gold_in_cash</code> (y-axis). So we need to pass instructions on how to use those data points appropriately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>))  </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That does not create the shape though. It only defines the starting point!</p>
<p>We need to inform D3 how wide and how tall (technically, it’s how deep) the chart should be drawn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>))  </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d <span class="kw">=&gt;</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">-</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>))<span class="op">;</span>  </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just for fun, trying commenting out the line <code>.attr("y", d =&gt; .....</code>. Notice how your plots start at the top?</p>
</section>
</section>
<section id="create-headings" class="level2">
<h2 class="anchored" data-anchor-id="create-headings">Create Headings</h2>
<p>If you recall our mockup, we had a heading and a subheading.</p>
<p>(show mockup)</p>
<p>Let’s go ahead and add those. Yes, just like before, we’ll make a function.</p>
<p>In your <code>D3/</code> directory, create the file <code>plot_header.js</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_header</span>(svg<span class="op">,</span> margin) {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">15</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"U.S. Gold Certificates in Treasury Cash"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">50</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"From November 1892 until December 1893"</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="beautification-of-our-visualization" class="level2">
<h2 class="anchored" data-anchor-id="beautification-of-our-visualization">Beautification of Our Visualization</h2>
<p>Aesthetically… our D3 visualization isn’t very pretty. That’s ironic, because what is usually so cool about D3 is the user-experience for the audience.</p>
<p>But that UX usually comes from the precision programming, which requires all the functional aspects to be determined first.</p>
<p>Now, we can work on making our visualization LOOK more like our mockup.</p>
<p>You may have noticed, we can apply <code>style</code> directly to our various components. However, this doesn’t make it easy to manage across functions. Particularly as we start to produce new visualizations using the same items.</p>
<p>This is where a <code>.css</code> style sheet comes in handy!</p>
</section>
<section id="add-color-to-plot_bar.js" class="level2">
<h2 class="anchored" data-anchor-id="add-color-to-plot_bar.js">Add Color to <code>plot_bar.js</code></h2>
<p>As you recall from our mockup, we actually have two colors to add: gold and grey.</p>
<p>Let’s first see how this works out.</p>
<p>Modify <code>plot_bar.js</code> to include some style arguments. Pay close attention to where I placed them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bar</span>(svg<span class="op">,</span> margin<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#AC882A"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#373735"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>))  </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d <span class="kw">=&gt;</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">-</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>))<span class="op">;</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-color-to-headers-axis-label---part-one" class="level2">
<h2 class="anchored" data-anchor-id="add-color-to-headers-axis-label---part-one">Add Color to Headers, Axis, Label - Part One</h2>
<p>Now we want to update the color on our axis, headers, etc. to use the dark gray defined in our mockup.</p>
<p>We could easily add style arguments to the <code>plot_header.js</code>, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_header</span>(svg<span class="op">,</span> margin) {</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#373735"</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">15</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"U.S. Gold Certificates in Treasury Cash"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#373735"</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">50</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"From November 1892 until December 1893"</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, this is starting to get tedious. And it doesn’t make it easy to update. For example, what if we wanted to play around with colors? We’d have to update each and every style block.</p>
<p>Let’s come back to this and build us a .css file.</p>
</section>
<section id="create-a-.css-file" class="level2">
<h2 class="anchored" data-anchor-id="create-a-.css-file">Create a <code>.css</code> File</h2>
<p>In your <code>D3/</code> directory, create the file <code>style.css</code>.</p>
<p>Next, we’re gonna define a class for our axis and headers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.header</span> {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fill</span><span class="ch">:</span> <span class="cn">#373735</span><span class="op">;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">.subheader</span> {</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fill</span><span class="ch">:</span> <span class="cn">#373735</span><span class="op">;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="fu">.axis</span> {</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fill</span><span class="ch">:</span> <span class="cn">#373735</span><span class="op">;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, that won’t update the D3 data viz on its own.</p>
<p>Next, we’re gonna modify <code>plot_gold_viz</code> to use this CSS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plot_gold_viz <span class="ot">&lt;-</span> <span class="cf">function</span>(jGold, <span class="at">directory_path =</span> <span class="st">"/cloud/project/D3"</span>) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> directory_path, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  js_scripts <span class="ot">&lt;-</span> file_list[<span class="fu">grepl</span>(<span class="st">".js"</span>,file_list)]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  r2d3<span class="sc">::</span><span class="fu">r2d3</span>(</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> jGold,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">script =</span> js_scripts,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">css =</span> <span class="fu">paste0</span>(directory_path, <span class="st">"/style.css"</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’re gonna update the following functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_header</span>(svg<span class="op">,</span> margin) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"header"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">15</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"U.S. Gold Certificates in Treasury Cash"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"subheader"</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">*</span> <span class="op">.</span><span class="dv">50</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"From November 1892 until December 1893"</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_x_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> x_dimension) {</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format_date <span class="op">=</span> d3<span class="op">.</span><span class="fu">utcFormat</span>(<span class="st">"%y %b"</span>)<span class="op">;</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(x_dimension)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(format_date)<span class="op">;</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis"</span>)</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(x_aesthetic)<span class="op">;</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x_dimension<span class="op">;</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_y_axis</span>(svg<span class="op">,</span> margin<span class="op">,</span> y_dimension) {</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Three: Define aesthetics</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y_aesthetic <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(y_dimension)</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(d <span class="kw">=&gt;</span> <span class="st">"$"</span> <span class="op">+</span> (d <span class="op">/</span> <span class="dv">1000000</span>) <span class="op">+</span> <span class="st">"M"</span>)<span class="op">;</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stage Four: Append to SVG</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis"</span>)</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(y_aesthetic)<span class="op">;</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also move our style cod efor <code>plot_bar.js</code> to css.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.gold-bar</span> {</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fill</span><span class="ch">:</span> <span class="cn">#AC882A</span><span class="op">;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’re gonna modify <code>plot_bar.js</code>. Notice where I place it! Tha’ts to prevent from black from initially appearign before the gold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> <span class="fu">plot_bar</span>(svg, margin, data, x_dimension, y_dimension) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svg.selectAll</span>(<span class="st">"gold-bar"</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.data</span>(data)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.enter</span>()</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.append</span>(<span class="st">"rect"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.attr</span>(<span class="st">"class"</span>, <span class="st">"gold-bar"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.attr</span>(<span class="st">"x"</span>, <span class="at">d =</span><span class="sc">&gt;</span> <span class="fu">x_dimension</span>(new <span class="fu">Date</span>(d.date)))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.attr</span>(<span class="st">"y"</span>, <span class="at">d =</span><span class="sc">&gt;</span> <span class="fu">y_dimension</span>(d.gold_in_cash))  </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.attr</span>(<span class="st">"width"</span>, <span class="dv">20</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.attr</span>(<span class="st">"height"</span>, <span class="at">d =</span><span class="sc">&gt;</span> height <span class="sc">-</span> margin.bottom <span class="sc">-</span> <span class="fu">y_dimension</span>(d.gold_in_cash));</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="changing-axis-and-text-colors" class="level2">
<h2 class="anchored" data-anchor-id="changing-axis-and-text-colors">Changing Axis and Text Colors</h2>
<p>Now, we need to use the dark grey color for our axis and text.</p>
<p>Since this</p>
<p>``</p>
</section>
<section id="changing-fonts" class="level2">
<h2 class="anchored" data-anchor-id="changing-fonts">Changing Fonts</h2>
</section>
<section id="create-line-shape" class="level2">
<h2 class="anchored" data-anchor-id="create-line-shape">Create Line Shape</h2>
<section id="back-to-plot_line.js" class="level3">
<h3 class="anchored" data-anchor-id="back-to-plot_line.js">Back to <code>plot_line.js</code></h3>
<p>Back to our empty <code>plot_line.js</code> function. We are appending a visual element to our SVG. So we’ll start with that…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_line</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="provide-data-for-your-shape" class="level3">
<h3 class="anchored" data-anchor-id="provide-data-for-your-shape">Provide Data for Your Shape</h3>
<p>We’ll need to inform the new path the data it will use to create its shape.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_line</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">datum</span>(data)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-line" class="level3">
<h3 class="anchored" data-anchor-id="add-line">Add Line</h3>
<p>How</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_line</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">datum</span>(data)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">x</span>(<span class="kw">function</span>(d) {<span class="cf">return</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>))})</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">y</span>(<span class="kw">function</span>(d) {<span class="cf">return</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>)})</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-style-arguments" class="level3">
<h3 class="anchored" data-anchor-id="add-style-arguments">Add Style Arguments</h3>
<p>What is supposed to be a line on our plot look like a black void of despair. Thankfully, SVG can respond to CSS style arguments, much in the same way any HTML tag can.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_line</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">datum</span>(data)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">x</span>(<span class="kw">function</span>(d) {<span class="cf">return</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>))})</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">y</span>(<span class="kw">function</span>(d) {<span class="cf">return</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>)})</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There will be different ways we manage the style arguemnts later. For now this will do.</p>
</section>
</section>
<section id="create-dots" class="level2">
<h2 class="anchored" data-anchor-id="create-dots">Create Dots</h2>
<p>Our mockup showed that we had dots to add to the lines. The good news is we have everything in place to do this!</p>
<p>We’re going to create a new file called <code>plot_dots.js</code> to place in our <code>D3/</code> directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_dot</span>(svg<span class="op">,</span> data<span class="op">,</span> x_dimension<span class="op">,</span> y_dimension) {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>) </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="kw">function</span> (d) {<span class="cf">return</span> <span class="fu">x_dimension</span>(<span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>))})</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="kw">function</span> (d) { <span class="cf">return</span> <span class="fu">y_dimension</span>(d<span class="op">.</span><span class="at">gold_in_cash</span>)<span class="op">;</span> }) </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>) </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"green"</span>)<span class="op">;</span> </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
data vs.&nbsp;datum
</div>
</div>
<div class="callout-body-container callout-body">
<p>asgag</p>
<p><code>datum</code> and <code>data().enter()</code></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>